@model IEnumerable<School_webapp.Models.Activity>

@{
    ViewData["Title"] = "Index";
}

<h1>Index</h1>

@using System.Globalization;
@{
    CultureInfo culture = new CultureInfo("en-EU");
}

<a asp-action="createActivity">Create new</a>
<hr />
<div class="row justify-content-center">
    <div class="col-12">
        @foreach (var item in Model)
        {
            string desc = @item.Description.Substring(0, Math.Min(200, item.Description.Length));
            if (item.Description.Length > 200)
            {
                desc += "...";
            }
            <div class="d-inline">
                <div class="float-start w-75">
                    <span class=""><a asp-action="Activity" asp-route-id="@item.activityId">@Html.DisplayFor(modelItem => item.Title)</a></span>
                    <br>
                    <p class="" style="color:gray; font-size:12px;">@desc</p>
                </div>
                <div class="float-end w-25">
                    <span class="badge @(DateTime.Today > item.deadline ? "bg-danger" : item.deadline.Subtract(DateTime.Today).Days <= 7? "bg-warning" : "bg-success") rounded">Deadline: @item.deadline.Date.ToString("D", culture)</span>
                    <div class="dropdown float-end">
                        <button class="btn dropdown-toggle" type="button" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false"> </button>
                        <!--if user is not teacher or admin-->
                        @{
                            if (User.IsInRole("Student"))
                            {
                                <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                                    <li><a class="dropdown-item" asp-action="Activityedit" asp-route-id="@item.activityId">Edit</a></li>
                                    <li><form method="post"><button class="dropdown-item" asp-action="delete" asp-route-id="@item.activityId" onclick="showAlert()">Delete</button></form></li>
                                    <li><a class="dropdown-item" asp-action="Activitypublish" asp-route-id="@item.activityId">Publish</a></li>
                                    <li><a class="dropdown-item" asp-action="Activityunpublish" asp-route-id="@item.activityId">Unpublish</a></li>
                                </ul>
                            }
                        }
                        
                    </div>
                </div>
            </div>
        }




    </div>
</div>
<script>
    function showAlert() {
        var respuesta = confirm("Are you sure? You will delete it permanently");
        if (!respuesta) {
            event.preventDefault();
        }
    }
</script>